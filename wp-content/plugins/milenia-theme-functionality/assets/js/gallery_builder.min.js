(function(b){b.milenia_gallery_builder=b.milenia_gallery_builder||{};b.milenia_gallery_builder.init=function(){this.$container=b("#milenia_gallery_builder");this.$container.on("click",".add_image_available_media",function(c){b.milenia_gallery_builder.add_available_media(c)}).on("click",".select_attach_id_from_media_library",function(c){b.milenia_gallery_builder.select_attach_id_from_media_library(c)}).on("click",".remove-item",function(c){b.milenia_gallery_builder.remove_item(c)}).on("click",".edit-item",function(c){b.milenia_gallery_builder.edit_item(c)});b(".sortable-img-items").sortable({activate:function(d,e){var f=b(this),c=f.outerHeight()-7;f.children(".ui-state-highlight").css("height",c)},placeholder:"ui-state-highlight",handle:".drag-item"});b("select.strip_custom_select").styler({selectSearch:true})};b.milenia_gallery_builder.add_available_media=function(k){k.preventDefault();var c=b(k.target),g=b(k.delegateTarget),f=c.data("type"),d=b("input[name=milenia_gallery_builder_nonce]",g).val(),j={action:"milenia_generate_inserted_media_to_slider",type:f,milenia_gallery_builder_nonce:d};if(f=="video"){b.ajax({type:"POST",url:ajaxurl,data:j,success:function(e){c.parents(".slider_option").find(".sortable-img-items").append(e)},complete:function(){setTimeout(function(){b(".img-item.add_animation").removeClass("add_animation")},500)},error:function(){}});return true}var i=wp.media.frames.file_frame=wp.media({title:"Select Images",button:{text:"Select"},multiple:true,library:{type:"image"}});var h=[];i.on("select",function(){i.state().get("selection").forEach(function(m,l,e){h[h.length]=m.id});j.itemsIDs=h.join(",");b.ajax({type:"POST",url:ajaxurl,data:j,success:function(e){c.parents(".slider_option").find(".sortable-img-items").append(e)},complete:function(){setTimeout(function(){b(".img-item.add_animation").removeClass("add_animation")},500)}})});i.open()};b.milenia_gallery_builder.select_attach_id_from_media_library=function(g){g.preventDefault();var c=b(g.target),d=c.parent(".meta-control");if(f){f.open();return}var f=wp.media.frames.file_frame=wp.media({title:b(this).data("uploader_title"),button:{text:b(this).data("uploader_button_text")},multiple:false});f.on("select",function(){attachment=f.state().get("selection").first().toJSON();d.children(".select_img_attachid").val(attachment.id);d.children(".select_img_preview").html("<img src='"+attachment.url+"' alt=''>")});f.open()};b.milenia_gallery_builder.remove_item=function(c){c.preventDefault();if(!b(c.target).length){return}b(c.target).parents(".img-item").animate({opacity:0},200,function(){b(this).animate({width:0},200,function(){b(this).remove()})})};b.milenia_gallery_builder.edit_item=function(c){c.preventDefault();new b.milenia_popup_gallery_builder(c,{on_load:function(){var g=this,f=b(".slider-range-x",g.modal),e=b(".bgposition_x",g.modal),d=b(".slider-range-y",g.modal),h=b(".bgposition_y",g.modal)}})};b.milenia_popup_gallery_builder=function(d,c){this.el=b(d.target);this.options=b.extend({},b.milenia_popup_gallery_builder.DEFAULTS,c);this.init()};b.milenia_popup_gallery_builder.DEFAULTS={on_load:function(){}};b.milenia_popup_gallery_builder.openInstance=[];b.milenia_popup_gallery_builder.prototype={init:function(){b.milenia_popup_gallery_builder.openInstance.unshift(this);var d=this;d.scope=false;d.doc=b(document);d.body=b("#milenia_gallery_builder");d.instance=b.milenia_popup_gallery_builder.openInstance.length;d.namespace=".milenia_popup_modal_"+d.instance;if(!d.el.length){return}d.container=d.el.parents(".img-item");d.modal=b(".popup-modal",d.container);d.overlay=b(".popup-modal-overlay",d.container);var c={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"};d.animEndEventName=c[Modernizr.prefixed("animation")];d.support={animations:Modernizr.cssanimations,touch:Modernizr.touch,csstransitions:Modernizr.csstransitions};d.loadPopup()},loadPopup:function(){var c=this;if(!c._fieldsEventsBinded){c._bindFieldEvents()}c.modal.addClass("modal-show");c.onLoadCallback();c.behavior()},_bindFieldEvents:function(){var c=this;c.modal.off("click.MileniaGalleryBuilder").on("click.MileniaGalleryBuilder",".popup-modal-manage-key-value-row",function(d){c[b(this).data("action")=="remove"?"removeKeyValueRow":"addKeyValueRow"].call(c,b(this));d.preventDefault()})},removeKeyValueRow:function(c){var d;if(!c||!c.length){return}d=c.closest(".popup-modal-key-value-row");if(d.length){d.remove()}},addKeyValueRow:function(d){if(!d||!d.length){return}var g=d.data("name-placeholder"),h=d.data("id-placeholder"),c=d.data("current-index"),e,f='<div class="popup-modal-key-value-row">					<div class="popup-modal-key-value-col">						<label for="@key_id@">@key_label@</label>						<input id="@key_id@"							   type="text"						       class="widefat"						       name="@key_name@"						       value="@key_value@">					</div>					<div class="popup-modal-key-value-col">						<label for="@value_id@">@value_label@</label>						<input id="@value_id@"							   type="text"						       class="widefat"						       name="@value_name@"						       value="@value_value@">					</div>					<div class="popup-modal-key-value-col popup-modal-key-value-col-button">						<button type="button" data-action="remove" class="button button-primary popup-modal-manage-key-value-row"><i class="dashicons dashicons-trash"></i></button>					</div>				</div>';if(g==undefined||c==undefined){return}c++;e=a(g,{index:c});d.data("currentIndex",c);d.before(a(f,{key_id:a(h,{globalindex:c,index:0}),key_name:e,key_label:MileniaGalleryBuilderLocalizedData.key,key_value:"",value_id:a(h,{globalindex:c,index:1}),value_name:e,value_label:MileniaGalleryBuilderLocalizedData.value,value_value:""}))},closeModal:function(){var c=this;c.modal.removeClass("modal-show");c.scope=false;b.milenia_popup_gallery_builder.openInstance.shift()},onLoadCallback:function(){var c=this.options.on_load;if(typeof c=="function"){c.call(this)}},behavior:function(){var c=this;b(".popup-modal-close",c.modal).add(c.overlay).on("click"+c.namespace,function(d){d.preventDefault();c.closeModal()})}};function a(f,g){var c,e;if(!f||!g){return}c=f;for(var d in g){e=new RegExp("@"+d+"@","g");c=c.replace(e,g[d])}return c}b(function(){b.milenia_gallery_builder.init()})})(window.jQuery);